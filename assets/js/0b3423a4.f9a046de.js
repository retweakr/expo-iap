"use strict";(globalThis.webpackChunkexpo_iap_docs=globalThis.webpackChunkexpo_iap_docs||[]).push([[5766],{571:(e,n,s)=>{s.d(n,{A:()=>t});var i=s(6540),r=s(4848);function a({className:e="adfit",style:n,unit:s,height:a,width:t}){return(0,i.useEffect)(()=>{const n=setTimeout(()=>{const n=document.querySelector(`.${e}`);if(!n)return void console.warn(`AdFit: Element with class "${e}" not found`);const i=n.querySelectorAll(".kakao_ad_area"),r=n.querySelectorAll('script[src*="kas/static/ba.min.js"]');i.forEach(e=>e.remove()),r.forEach(e=>e.remove());const c=document.createElement("ins"),l=document.createElement("script");c.className="kakao_ad_area",c.style.cssText="display:none; width:100%;",l.async=!0,l.type="text/javascript",l.src="//t1.daumcdn.net/kas/static/ba.min.js",c.setAttribute("data-ad-width",t.toString()),c.setAttribute("data-ad-height",a.toString()),c.setAttribute("data-ad-unit",s),n.appendChild(c),n.appendChild(l)},100);return()=>clearTimeout(n)},[e,s,a,t]),(0,r.jsx)("div",{style:n,children:(0,r.jsx)("div",{className:e})})}function t(){return(0,r.jsx)(a,{unit:"DAN-YTmjDwlbcP42HBg6",height:100,width:320,className:"adfit-top",style:{flex:1,marginTop:24,marginBottom:24}})}},7939:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>c,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"examples/purchase-flow","title":"Purchase Flow Example","description":"This example walks through a clean purchase flow using expo-iap with the useIAP hook and the new platform\u2011specific request shape. It mirrors the working sample in example/app/purchase-flow.tsx.","source":"@site/versioned_docs/version-3.0/examples/purchase-flow.md","sourceDirName":"examples","slug":"/examples/purchase-flow","permalink":"/expo-iap/docs/3.0/examples/purchase-flow","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/expo-iap/tree/main/docs/versioned_docs/version-3.0/examples/purchase-flow.md","tags":[],"version":"3.0","sidebarPosition":1,"frontMatter":{"title":"Purchase Flow Example","sidebar_label":"Purchase Flow","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Error Codes","permalink":"/expo-iap/docs/3.0/api/error-codes"},"next":{"title":"Subscriptions Flow","permalink":"/expo-iap/docs/3.0/examples/subscription-flow"}}');var r=s(4848),a=s(8453),t=s(571);const c={title:"Purchase Flow Example",sidebar_label:"Purchase Flow",sidebar_position:1},l="Purchase Flow",o={},d=[{value:"Flow Overview",id:"flow-overview",level:2},{value:"Key Concepts",id:"key-concepts",level:2},{value:"1. Connection Management",id:"1-connection-management",level:3},{value:"2. Product Loading",id:"2-product-loading",level:3},{value:"3. Purchase Flow",id:"3-purchase-flow",level:3},{value:"4. Receipt Validation",id:"4-receipt-validation",level:3},{value:"5. User Experience",id:"5-user-experience",level:3},{value:"Platform Differences",id:"platform-differences",level:2},{value:"Purchase Request Parameters",id:"purchase-request-parameters",level:3},{value:"Key iOS Options",id:"key-ios-options",level:3},{value:"Purchase Object Properties",id:"purchase-object-properties",level:3},{value:"Receipt Validation",id:"receipt-validation",level:3},{value:"Usage",id:"usage",level:2},{value:"Customization",id:"customization",level:2},{value:"Next Steps",id:"next-steps",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"purchase-flow",children:"Purchase Flow"})}),"\n",(0,r.jsx)(t.A,{}),"\n",(0,r.jsxs)(n.p,{children:["This example walks through a clean purchase flow using expo-iap with the ",(0,r.jsx)(n.code,{children:"useIAP"})," hook and the new platform\u2011specific request shape. It mirrors the working sample in ",(0,r.jsx)(n.code,{children:"example/app/purchase-flow.tsx"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"View the full example source:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["GitHub: ",(0,r.jsx)(n.a,{href:"https://github.com/hyochan/expo-iap/blob/main/example/app/purchase-flow.tsx",children:"example/app/purchase-flow.tsx"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"flow-overview",children:"Flow Overview"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Initialize: ",(0,r.jsx)(n.code,{children:"useIAP"})," manages the store connection lifecycle"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Load products:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"fetchProducts({ skus, type: 'in-app' })"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Start purchase:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"requestPurchase({ request: { ios: { sku }, android: { skus: [sku] } }, type: 'in-app' })"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Receive callbacks: ",(0,r.jsx)(n.code,{children:"onPurchaseSuccess"})," / ",(0,r.jsx)(n.code,{children:"onPurchaseError"})," (from ",(0,r.jsx)(n.code,{children:"useIAP"}),")"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Validate server\u2011side: send receipt/JWS or token to your backend"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Finish transaction:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"finishTransaction({ purchase, isConsumable })"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"Connect \u2192 Fetch Products \u2192 Request Purchase \u2192 Server Validate \u2192 Finish Transaction\n"})}),"\n",(0,r.jsx)(n.h2,{id:"key-concepts",children:"Key Concepts"}),"\n",(0,r.jsx)(n.h3,{id:"1-connection-management",children:"1. Connection Management"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"useIAP"})," automatically opens/closes the connection"]}),"\n",(0,r.jsxs)(n.li,{children:["Exposes ",(0,r.jsx)(n.code,{children:"connected"}),", convenient for showing loading states"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-product-loading",children:"2. Product Loading"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Load in\u2011app products or subscriptions (set ",(0,r.jsx)(n.code,{children:"type"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Handle and log failed product fetches"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-purchase-flow",children:"3. Purchase Flow"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Start purchases via unified request shape (no ",(0,r.jsx)(n.code,{children:"Platform.OS"})," branching)"]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"onPurchaseSuccess"}),"/",(0,r.jsx)(n.code,{children:"onPurchaseError"})," from ",(0,r.jsx)(n.code,{children:"useIAP"})]}),"\n",(0,r.jsxs)(n.li,{children:["Always call ",(0,r.jsx)(n.code,{children:"finishTransaction"})," after server validation"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-receipt-validation",children:"4. Receipt Validation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Perform validation on your backend (never only on device)"}),"\n",(0,r.jsx)(n.li,{children:"iOS: validate the receipt/JWS; Android: validate purchase token + package name"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"5-user-experience",children:"5. User Experience"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Provide clear states for loading, success, and error"}),"\n",(0,r.jsx)(n.li,{children:"Show subscription management/deep\u2011links when appropriate"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"platform-differences",children:"Platform Differences"}),"\n",(0,r.jsx)(n.h3,{id:"purchase-request-parameters",children:"Purchase Request Parameters"}),"\n",(0,r.jsxs)(n.p,{children:["Use the modern, platform\u2011specific request container (v2.7.0+). This avoids manual ",(0,r.jsx)(n.code,{children:"Platform.OS"})," checks:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"await requestPurchase({\n  request: {\n    ios: {sku: productId, quantity: 1},\n    android: {skus: [productId]},\n  },\n  type: 'in-app',\n});\n"})}),"\n",(0,r.jsx)(n.p,{children:"Notes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Keep ",(0,r.jsx)(n.code,{children:"andDangerouslyFinishTransactionAutomatically"})," off (default) to validate first."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"key-ios-options",children:"Key iOS Options"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"appAccountToken"}),": set per user to correlate receipts on your backend"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"quantity"}),": purchase quantity for iOS (consumables)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"purchase-object-properties",children:"Purchase Object Properties"}),"\n",(0,r.jsx)(n.p,{children:"Purchase objects have different properties on iOS and Android. When accessing platform-specific properties, TypeScript type casting is required:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"// Unified fields\nconst token = purchase.purchaseToken; // iOS JWS or Android token\n\n// Android-only helpers\n// const pkg = (purchase as PurchaseAndroid).packageNameAndroid;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"receipt-validation",children:"Receipt Validation"}),"\n",(0,r.jsx)(n.p,{children:"Receipt validation requires different approaches:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"iOS: verify receipt/JWS on your server against Apple"}),"\n",(0,r.jsx)(n.li,{children:"Android: verify token and package name against Google Play Developer API"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import React from 'react';\nimport {NavigationContainer} from '@react-navigation/native';\nimport PurchaseFlow from './purchase-flow';\n\nexport default function App() {\n  return (\n    <NavigationContainer>\n      <PurchaseFlow />\n    </NavigationContainer>\n  );\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"customization",children:"Customization"}),"\n",(0,r.jsx)(n.p,{children:"You can customize this example by:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Styling"}),": Modify the ",(0,r.jsx)(n.code,{children:"styles"})," object to match your app's design"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Product IDs"}),": Update ",(0,r.jsx)(n.code,{children:"PRODUCT_IDS"})," with your actual product IDs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validation"}),": Implement proper server-side receipt validation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Error Handling"}),": Add more specific error handling for your use case"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Features"}),": Add features like purchase restoration, subscription management, etc."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Implement proper ",(0,r.jsx)(n.a,{href:"../guides/purchases#receipt-validation",children:"receipt validation"})]}),"\n",(0,r.jsxs)(n.li,{children:["Add ",(0,r.jsx)(n.a,{href:"../guides/purchases#purchase-restoration",children:"purchase restoration"})]}),"\n",(0,r.jsxs)(n.li,{children:["Handle ",(0,r.jsx)(n.a,{href:"../api/methods/core-methods#deeplinktosubscriptions",children:"subscription management"})]}),"\n",(0,r.jsxs)(n.li,{children:["Add comprehensive ",(0,r.jsx)(n.a,{href:"../api/error-handling",children:"error handling"})]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var i=s(6540);const r={},a=i.createContext(r);function t(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);